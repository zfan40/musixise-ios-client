<!DOCTYPE html>
<html>
    
    <head>
        <meta charset="utf-8">
            <title></title>
            <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
            <!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
            <meta name="apple-mobile-web-app-capable" content="yes">
            <meta name="apple-mobile-web-app-status-bar-style" content="black">
            <meta name="format-detection" content="telephone=no">
            <!-- uc强制竖屏 -->
            <meta name="screen-orientation" content="portrait">
            <!-- qq强制竖屏 -->
            <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
            <meta http-equiv="Pragma" content="no-cache">
            <meta http-equiv="Expires" content="0">
            <script>
                ;
                (function() {
                 var win = window,
                 docElem = document.documentElement,
                 timeoutId;
                 setRem();
                 docElem.setAttribute('data-dpr', win.devicePixelRatio);
                 win.addEventListener('resize', delaySetRem, false);
                 win.addEventListener('pageshow', function(e) {
                                      e.persisted && delaySetRem()
                                      }, false);
                 
                 function delaySetRem() {
                 clearTimeout(timeoutId);
                 timeoutId = setTimeout(setRem, 300)
                 }
                 
                 function setRem() {
                 win.rem = docElem.getBoundingClientRect().width / 10;
                 docElem.style.fontSize = win.rem + 'px'
                 }
                 })();
                </script>
                <style type="text/css">
                    button {
                        display:block;
                    }
                </style>
    </head>
    
    <body>
        <button onclick="showUserAgent()">展示UA</button>
        <button onclick="playPiece(28)">播放作品</button>
        <button onclick="uploadImage()">上传图片</button>
        <button onclick="getUserInfo()">获取用户信息</button>
        <button onclick="setTitle('title updated')">设置title</button>
        <button onclick="showToast('this is a toast')">toast</button>

        <script>
        // jsbridge
        var MUSIXISE = undefined;
        
        function connectWebViewJavascriptBridge(callback) {
            if (window.WebViewJavascriptBridge) {
                callback(WebViewJavascriptBridge)
            } else {
                document.addEventListener('WebViewJavascriptBridgeReady', function() {
                    callback(WebViewJavascriptBridge)
                }, false)
            }
        }
        
        // 调用处理
        function callHandler(evt, data, callback) {
            if (!MUSIXISE) {
                connectWebViewJavascriptBridge(function(bridge) {
                    bridge.init(function(message,responseCallback){
                        responseCallback(data);
                    })
                   MUSIXISE = bridge;
                   bridge.callHandler(evt, data, callback)
                })
            } else {
                MUSIXISE.callHandler(evt, data, callback)
            }
        }

        function getUserInfo() {
            alert("calling GetUserInfo");
            callHandler('GetUserInfo', {}, function(res) {
                        alert(1);
                alert(JSON.stringify(res));
            });
        }
        
        function playPiece(songid) {
            location.href = 'musixise://play?id='+songid;
        }
        
        function uploadImage() {
            callHandler('UploadImage',{},function(res){
                alert(JSON.stringify(res));
            })
        }

        function setTitle(title) {
            callHandler('SetTitle',title,function(res){

            })            
        }
        function showToast(msg) {
            callHandler('ShowToast',msg,function(res){

            })                 
        }
        function showUserAgent() {
            alert(JSON.stringify(navigator.userAgent));
        }
        </script>
    </body>
    
</html>
